<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="https://gamefiles.f0c.org/s1/style.css">
    <script defer="defer">
      (() => {
        "use strict";
        var e = {
            678: () => {
              window.addEventListener("blur", function () {
                window.parent.postMessage({ type: "syncUnityData" }, "*");
              }),
                window.addEventListener("keydown", function (e) {
                  "Escape" === e.key &&
                    window.parent.postMessage(
                      { type: "escapeFullscreen" },
                      "*"
                    );
                }),
                (window.sendDelayedMemoryUsage = function () {
                  setTimeout(() => {
                    const e =
                      null == window ? void 0 : window.performance.memory;
                    if (!e) return;
                    const {
                      totalJSHeapSize: n,
                      usedJSHeapSize: t,
                      jsHeapSizeLimit: o,
                    } = e;
                    window.parent.postMessage(
                      {
                        type: "unityMemoryUsage",
                        usageData: {
                          type: "memoryUsage",
                          totalJSHeapSize: n,
                          usedJSHeapSize: t,
                          jsHeapSizeLimit: o,
                        },
                      },
                      "*"
                    );
                  }, 1e4);
                });
            },
            951: () => {
              (() => {
                function e(e, n) {
                  window.unityGameInstance && window.crazySDKObjectName
                    ? (window.debugStub(
                        "Send message to Unity game instance",
                        e,
                        n
                      ),
                      window.unityGameInstance.SendMessage(
                        window.crazySDKObjectName,
                        e,
                        n
                      ))
                    : window.debugStub(
                        "unityGameInstance or crazySDKObjectName not defined, cannot send message",
                        e,
                        n
                      );
                }
                (window.stubDebugEnabled = window.location.href.includes(
                  "iframed_unity_debug=true"
                )),
                  (window.crazySDKObjectName = null),
                  (window.oldSdkInitObject = null),
                  (window.debugStub = function (...e) {
                    window.stubDebugEnabled && console.log("[StubSDK]", ...e);
                  }),
                  window.addEventListener("message", (n) => {
                    if ("sendUnityMessage" === n.data.type) {
                      if ("InitCallback" === n.data.methodName) return;
                      window.debugStub("Got GF event", n.data),
                        e(n.data.methodName, n.data.value);
                    }
                  }),
                  (window.Crazygames = {
                    load: () => {
                      window.debugStub("Crazygames.load");
                    },
                    init: (n) => {
                      // if (
                      //   (window.debugStub("Crazygames.init forwarded to GF", n),
                      //   (window.crazySDKObjectName = n.crazySDKObjectName),
                      //   window.parent.postMessage(
                      //     { type: "window.Crazygames.init", options: n },
                      //     "*"
                      //   ),
                      //   window.oldSdkInitObject)
                      // )
                      //   e(
                      //     "InitCallback",
                      //     JSON.stringify(window.oldSdkInitObject)
                      //   );
                      // else {
                      //   const n = {
                      //     gameLink:
                      //       "https://www.crazygames.com/game/" +
                      //       new URL(window.location.href).hostname.split(
                      //         "."
                      //       )[0],
                      //     userInfo: {
                      //       countryCode: "US",
                      //       device: { type: "desktop" },
                      //       os: { name: "Windows", version: "11" },
                      //       browser: { name: "Chrome", version: "130.0.0.0" },
                      //     },
                      //   };
                      //   window.debugStub(
                      //     "No oldSdkInitObject to send, sending temporary init object",
                      //     n
                      //   ),
                      //     e("InitCallback", JSON.stringify(n));
                      // }
                    },
                    requestAd: (e) => {
                      window.debugStub(
                        "Crazygames.requestAd forwarded to GF",
                        e
                      ),
                        window.parent.postMessage(
                          { type: "window.Crazygames.requestAd", adType: e },
                          "*"
                        );
                    },
                    happytime: () => {
                      window.debugStub("Crazygames.happytime");
                    },
                    gameplayStart: () => {
                      window.debugStub("Crazygames.gameplayStart");
                    },
                    gameplayStop: () => {
                      window.debugStub("Crazygames.gameplayStop");
                    },
                    sdkGameLoadingStart: () => {
                      window.debugStub("Crazygames.sdkGameLoadingStart");
                    },
                    sdkGameLoadingStop: () => {
                      window.debugStub("Crazygames.sdkGameLoadingStop");
                    },
                    requestInviteUrl: (e) => {
                      window.debugStub("Crazygames.requestInviteUrl", e);
                    },
                    requestBanners: (e) => {
                      window.debugStub("Crazygames.requestBanners", e),
                        console.warn(
                          "Stub SDK doesn't support banners, please migrate to the new Unity SDK"
                        );
                    },
                    screenshotReceived: () => {
                      window.debugStub("Crazygames.screenshotReceived");
                    },
                    constants: [],
                    getUnityInstance: () => {},
                  }),
                  (window.CrazySDK = {
                    init: function (e) {
                      window.debugStub("CrazySDK.init", e),
                        window.Crazygames.init(e);
                    },
                    requestAd: function (e) {
                      window.debugStub("CrazySDK.requestAd", e),
                        window.Crazygames.requestAd(e);
                    },
                  });
              })();
            },
            553: () => {
              (() => {
                var e = Object.defineProperty,
                  n = Object.getOwnPropertySymbols,
                  t = Object.prototype.hasOwnProperty,
                  o = Object.prototype.propertyIsEnumerable,
                  r = (n, t, o) =>
                    t in n
                      ? e(n, t, {
                          enumerable: !0,
                          configurable: !0,
                          writable: !0,
                          value: o,
                        })
                      : (n[t] = o),
                  a = (e, n, t) =>
                    new Promise((o, r) => {
                      var a = (e) => {
                          try {
                            d(t.next(e));
                          } catch (e) {
                            r(e);
                          }
                        },
                        i = (e) => {
                          try {
                            d(t.throw(e));
                          } catch (e) {
                            r(e);
                          }
                        },
                        d = (e) =>
                          e.done
                            ? o(e.value)
                            : Promise.resolve(e.value).then(a, i);
                      d((t = t.apply(e, n)).next());
                    });
                function i(e) {
                  window.parent.postMessage(
                    { type: "loadProgress", progress: e },
                    "*"
                  ),
                    1 === e && window.sendDelayedMemoryUsage();
                }
                function d() {
                  var e;
                  document.hasFocus() ||
                    (window.debugLog("Cleaning up listener and focusing"),
                    window.focus(),
                    null == (e = window.getUnityCanvas()) ||
                      e.removeEventListener("touchstart", d));
                }
                (window.debugEnabled = window.location.href.includes(
                  "iframed_unity_debug=true"
                )),
                  (window.config = null),
                  (window.unityGameInstance = null),
                  (window.canvas = null),
                  (window.debugLog = function (...e) {
                    window.debugEnabled &&
                      console.log("[IframedUnity2020]", ...e);
                  }),
                  (window.getUnityCanvas = function () {
                    return (
                      window.canvas ||
                        (window.canvas =
                          document.getElementById("unity-canvas")),
                      window.canvas
                    );
                  }),
                  window.addEventListener("message", function (e) {
                    return a(this, null, function* () {
                      switch (e.data.type) {
                        case "unity2020config":
                          window.debugLog("Got config", e.data),
                            (window.config = e.data),
                            (window.oldSdkInitObject = e.data.oldSdkInitObject);
                          break;
                        case "loadGame":
                          window.debugLog("Requested loadGame"),
                            window.loadGame();
                          break;
                        case "focusGame":
                          window.focus();
                          break;
                        case "disableGame":
                          window.unityGameInstance &&
                            window.unityGameInstance.Quit();
                      }
                    });
                  }),
                  window.addEventListener("load", function () {
                    window.parent.postMessage({ type: "unity2020ready" }, "*");
                  }),
                  (window.loadGame = function () {
                    return a(this, null, function* () {
                      if (!window.config)
                        return void console.error(
                          "[IframedUnity2020] config is missing"
                        );
                      const e = ((e, a) => {
                          for (var i in a || (a = {}))
                            t.call(a, i) && r(e, i, a[i]);
                          if (n)
                            for (var i of n(a)) o.call(a, i) && r(e, i, a[i]);
                          return e;
                        })({}, window.config.unityConfig),
                        d = new URLSearchParams(window.location.search),
                        s = "true" === d.get("isPreview"),
                        w = "true" === d.get("enableUnityCache");
                      s &&
                        !w &&
                        (yield (function () {
                          return a(this, null, function* () {
                            return new Promise((e) => {
                              const n = indexedDB.open("/idbfs");
                              (n.onsuccess = () => {
                                const t = n.result;
                                try {
                                  if (!t.objectStoreNames.contains("FILE_DATA"))
                                    return t.close(), void e();
                                  const n = t.transaction(
                                      ["FILE_DATA"],
                                      "readwrite"
                                    ),
                                    o = n.objectStore("FILE_DATA"),
                                    r = o.getAllKeys();
                                  (r.onsuccess = () => {
                                    r.result
                                      .filter(
                                        (e) =>
                                          "string" == typeof e &&
                                          (e.includes("/UnityCache/") ||
                                            e.includes("/Unity/"))
                                      )
                                      .forEach((e) => o.delete(e));
                                  }),
                                    (n.oncomplete = () => {
                                      t.close(), e();
                                    }),
                                    (n.onerror = () => {
                                      t.close(), e();
                                    });
                                } catch (n) {
                                  t.close(), e();
                                }
                              }),
                                (n.onerror = () => e()),
                                (n.onblocked = () => e());
                            });
                          });
                        })(),
                        yield (function () {
                          return a(this, null, function* () {
                            const e = yield caches.keys();
                            for (const n of e)
                              n.startsWith("UnityCache_") &&
                                (yield caches.delete(n),
                                window.debugLog(
                                  "Cleaned cached network requests:",
                                  n
                                ));
                          });
                        })(),
                        (e.cacheControl = () => "no-store"),
                        window.debugLog("Disabling cache for preview")),
                        s ||
                          (e.cacheControl = (e) =>
                            e.includes("files.crazygames.com") ||
                            e.includes("files.dev-crazygames.be")
                              ? "immutable"
                              : "must-revalidate");
                      var u = document.createElement("script");
                      (u.type = "text/javascript"),
                        (u.onload = function () {
                          return a(this, null, function* () {
                            if (window.config && window.createUnityInstance)
                              try {
                                window.debugLog("Creating Unity instance", e),
                                  (window.unityGameInstance =
                                    yield window.createUnityInstance(
                                      window.getUnityCanvas(),
                                      e,
                                      i
                                    )),
                                  window.debugLog("Game loaded");
                              } catch (e) {
                                console.error("[IframedUnity2020] error", e),
                                  window.parent.postMessage(
                                    { type: "unityError", error: e },
                                    "*"
                                  );
                              }
                          });
                        }),
                        (u.src = window.config.loaderOptions.unityLoaderUrl),
                        document.body.appendChild(u),
                        window.debugLog("Loading loader script", u.src);
                    });
                  }),
                  window.addEventListener("blur", () => {
                    var e;
                    window.debugLog("Adding touch start listener"),
                      null == (e = window.getUnityCanvas()) ||
                        e.addEventListener("touchstart", d);
                  });
              })();
            },
            729: () => {
              (() => {
                const e = [
                  [
                    "exception handling has been disabled",
                    "noExceptionSupport",
                  ],
                  [
                    "The browser could not allocate enough memory",
                    "failedToAllocateMemory",
                  ],
                  ["Out of memory", "outOfMemory"],
                  ["out of memory", "outOfMemory"],
                  ["abort", "AbortedError"],
                  ["NotAllowedError", "NotAllowedError"],
                  ["TypeError", "TypeError"],
                  ["ScriptError", "ScriptError"],
                  ["NotSupportedError", "NotSupportedError"],
                  ["RuntimeError", "RuntimeError"],
                  ["RangeError", "RangeError"],
                  ["InvalidStateError", "InvalidStateError"],
                  ["SDK Not initialized", "SDKNotInitializedError"],
                  ["NetworkError", "NetworkError"],
                  ["DataCloneError", "DataCloneError"],
                  ["ReferenceError", "ReferenceError"],
                  ["SecurityError", "SecurityError"],
                  ["InvalidAccessError", "InvalidAccessError"],
                  ["ChunkLoadError", "ChunkLoadError"],
                  ["QuotaExceededError", "QuotaExceededError"],
                  ["TimeoutError", "TimeoutError"],
                  ["NotFoundError", "NotFoundError"],
                  ["NS_ERROR_", "NSError"],
                  [
                    "An error occurred running the Unity content on this page",
                    "unknown",
                  ],
                ];
                let n = !1;
                const t = (t, o) => {
                  if (n) return !0;
                  let r;
                  if (((n = !0), "string" != typeof t)) return (n = !1), !1;
                  for (let n of e)
                    if (t.includes(n[0])) {
                      r = n[1];
                      break;
                    }
                  return r
                    ? (window.parent.postMessage(
                        {
                          type: "unityCrashError",
                          error: r,
                          errorMessage: `${t}`,
                          origin: o,
                        },
                        "*"
                      ),
                      !0)
                    : ((n = !1), !1);
                };
                var o;
                (o = window.alert),
                  (window.alert = function () {
                    if (!t(arguments[0] || "", "alert"))
                      return o.apply(this, arguments);
                    window.parent.postMessage(
                      { type: "unityCrashModalOpen" },
                      "*"
                    );
                  }),
                  (function (e) {
                    console.error = function () {
                      return (
                        t(arguments[0] || "", "console"),
                        e.apply(this, arguments)
                      );
                    };
                  })(console.error);
              })();
            },
          },
          n = {};
        function t(o) {
          var r = n[o];
          if (void 0 !== r) return r.exports;
          var a = (n[o] = { exports: {} });
          return e[o](a, a.exports, t), a.exports;
        }
        t(951), t(678), t(729), t(553);
      })();
      //# sourceMappingURL=unity2020.js.map
    </script>
  </head>
  <body>
    <div id="unity-container" class="unity-desktop">
      <canvas id="unity-canvas" tabindex="-1"></canvas>
      <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
          <div id="unity-progress-bar-full"></div>
        </div>
      </div>
      <div id="unity-warning"> </div>
      <div id="unity-footer">
        <div id="unity-webgl-logo"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">game2048</div>
      </div>
    </div>

    <script>

      // Object.defineProperty(navigator, 'userAgent', {
      //   get: function () {
      //     return "Mozilla/5.0 (Linux; Android 12; Pixel 5 Build/SPP3.210618.011) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.133 Mobile Safari/537.36";
      //   },
      //   configurable: true
      // });

      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");
      var fullscreenButton = document.querySelector("#unity-fullscreen-button");
            var warningBanner = document.querySelector("#unity-warning");

      function resizeCanvas() {
        const pixelRatio = window.devicePixelRatio || 1;
        const width = container.clientWidth;
        const height = container.clientHeight;

        canvas.width = Math.floor(width * pixelRatio);
        canvas.height = Math.floor(height * pixelRatio);

        canvas.style.width = width + "px";
        canvas.style.height = height + "px";
  // === 强制浏览器重绘 ===
  // canvas.style.display = 'none';
  // canvas.offsetHeight; // 触发浏览器重绘
  // canvas.style.display = 'block';

  // // === 可选：通知 Unity 刷新渲染缓冲 ===
  // if (window.unityInstance && window.unityInstance.Module) {
  //   const ctx = window.unityInstance.Module.context;
  //   if (ctx && ctx.viewport) {
  //     ctx.viewport(0, 0, canvas.width, canvas.height);
  //   }
  // }
      }

      // 页面加载和窗口 resize 时调用
      window.addEventListener("load", resizeCanvas);
      window.addEventListener("resize", resizeCanvas);

      // Shows a temporary message banner/ribbon for a few seconds, or
      // a permanent error message on top of the canvas if type=='error'.
      // If type=='warning', a yellow highlight color is used.
      // Modify or remove this function to customize the visually presented
      // way that non-critical warnings and error messages are presented to the
      // user.
      function unityShowBanner(msg, type) {
        function updateBannerVisibility() {
          warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
        }
        var div = document.createElement('div');
        div.innerHTML = msg;
        warningBanner.appendChild(div);
        if (type == 'error') div.style = 'background: red; padding: 10px;';
        else {
          if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
          setTimeout(function() {
            warningBanner.removeChild(div);
            updateBannerVisibility();
          }, 5000);
        }
        updateBannerVisibility();
      }

      var buildUrl = "Build";
      var loaderUrl = "https://gamefiles.f0c.org/s1/CrazyGames.loader.js";
      var config = {
      dataUrl: "https://gamefiles.f0c.org/game/puppet-fighter-2-player/4/Puppet Fighter Crazy Games/Build/Puppet Fighter Crazy Games.data.br",
        frameworkUrl: "https://gamefiles.f0c.org/game/puppet-fighter-2-player/4/Puppet Fighter Crazy Games/Build/Puppet Fighter Crazy Games.framework.js.br",
        codeUrl: "https://gamefiles.f0c.org/game/puppet-fighter-2-player/4/Puppet Fighter Crazy Games/Build/Puppet Fighter Crazy Games.wasm.br",
        streamingAssetsUrl: "https://gf.f0c.org/f1/puppet-fighter-2-player/4/Puppet Fighter Crazy Games/StreamingAssets",
        companyName: "DefaultCompany",
        productName: "game2048",
        productVersion: "1.0",
        showBanner: unityShowBanner,
      };

      // By default, Unity keeps WebGL canvas render target size matched with
      // the DOM size of the canvas element (scaled by window.devicePixelRatio)
      // Set this to false if you want to decouple this synchronization from
      // happening inside the engine, and you would instead like to size up
      // the canvas DOM size and WebGL render target sizes yourself.
      config.matchWebGLToCanvasSize = false;

      // If you would like all file writes inside Unity Application.persistentDataPath
      // directory to automatically persist so that the contents are remembered when
      // the user revisits the site the next time, uncomment the following line:
      // config.autoSyncPersistentDataPath = true;
      // This autosyncing is currently not the default behavior to avoid regressing
      // existing user projects that might rely on the earlier manual
      // JS_FileSystem_Sync() behavior, but in future Unity version, this will be
      // expected to change.

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        // Mobile device style: fill the whole browser client area with the game canvas:

        var meta = document.createElement('meta');
        meta.name = 'viewport';
        meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
        document.getElementsByTagName('head')[0].appendChild(meta);
        container.className = "unity-mobile";
        canvas.className = "unity-mobile";

        const pixelRatio = window.devicePixelRatio;
        const logicalWidth = Math.floor(window.innerWidth);
        const logicalHeight = Math.floor(window.innerHeight);

        //canvas.width = 1920;
        //canvas.height = 1080;

        //canvas.style.width = window.innerWidth;
        //canvas.style.height = window.innerHeight;

        console.log('实际分辨率:', canvas.width, canvas.height);

        // To lower canvas resolution on mobile devices to gain some
        // performance, uncomment the following line:
        // config.devicePixelRatio = 1;


      }
       else {
        // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:

        const pixelRatio = window.devicePixelRatio;
        const logicalWidth = Math.floor(window.innerWidth);
        const logicalHeight = Math.floor(window.innerHeight);

        //canvas.width = 1920;
        //canvas.height = 1080;

        //canvas.style.width = window.innerWidth;
        //canvas.style.height = window.innerHeight;
      }

      loadingBar.style.display = "block";

      var script = document.createElement("script");
      script.src = loaderUrl;
script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
          // 新增：向父页面发送进度
    window.parent.postMessage(
      { type: "unity-progress", progress: Math.round(progress * 100) },
      "*"
    );
              }).then((unityInstance) => {
                loadingBar.style.display = "none";
                fullscreenButton.onclick = () => {
                  unityInstance.SetFullscreen(1);
                };
                // 新增：向父页面发送进度
    window.parent.postMessage(
      { type: "unity-progress", progress: Math.round(100) },
      "*"
    );
              }).catch((message) => {
                alert(message);
              });
            };

      document.body.appendChild(script);

      // var gamepush_pc_script = document.createElement("script");
      // gamepush_pc_script.src = "Build/gamepush_pc.js";
      // document.body.appendChild(gamepush_pc_script);

    </script>
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"f0213b5811e2457ab8d086fa63bec884","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>